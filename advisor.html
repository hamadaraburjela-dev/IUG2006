<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ø°ÙƒÙŠ â€“ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø¨ØºØ²Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" referrerpolicy="no-referrer" rel="stylesheet"/>
<link href="assets/css/main.css" rel="stylesheet"/>

<style>
  :root{
    --iug-green:#0a6b3a; --iug-green-700:#075836; --bg:#f4fbf7; --card:#ffffff;
    --muted:#5c6d63; --radius:14px; --shadow-soft:0 10px 30px rgba(6,60,40,0.06);
    --accent:linear-gradient(90deg,var(--iug-green),var(--iug-green-700));
  }
  *{box-sizing:border-box}
  html,body{height:100%} 
  /* Use flex centering similar to the site's global layout, but keep a top offset for the fixed status bar */
  /* center content visually while keeping top offset for the fixed status bar */
  body{display:flex;justify-content:center;align-items:center;min-height:100vh;padding-top:70px;padding-left:0;padding-right:0; font-family:'Cairo',sans-serif;background:var(--bg);margin:0;color:#153;line-height:1.4}
  #status-bar-placeholder{height:12px}

  /* shell is centered by the body; make it an explicit flex container to guarantee centering */
  .shell{width:100%;max-width:980px;margin:36px auto;padding:12px;display:flex;justify-content:center}
  .container{width:100%;max-width:980px;background:var(--card);border-radius:16px;overflow:hidden;box-shadow:var(--shadow-soft);border:1px solid rgba(10,107,58,0.04);margin-inline:auto}

  /* Intro */
  .intro{padding:22px 20px;border-bottom:1px solid #edf6ef}
  .intro h1{color:var(--iug-green);text-align:center;font-size:1.45rem;margin:0 0 8px}
  .intro p{color:var(--muted);text-align:center;margin:0 0 12px}
  .hero{display:flex;align-items:center;justify-content:center;margin:12px auto;width:min(620px,92%);height:110px;border-radius:12px;background:linear-gradient(180deg,rgba(10,107,58,0.06),rgba(7,130,79,0.04));font-size:40px}

  .features{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
  .feature{background:#fbfffb;border-radius:10px;padding:12px;border:1px solid rgba(10,107,58,0.04);text-align:center}
  .feature h3{color:var(--iug-green);font-size:0.98rem;margin-bottom:6px}

  .center{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:14px}
  .btn{border:none;border-radius:999px;padding:12px 18px;font-size:1rem;color:#fff;cursor:pointer}
  .btn.primary{background:var(--accent);box-shadow:0 8px 24px rgba(10,107,58,0.12)}
  .btn.ghost{background:transparent;color:var(--iug-green);border:1px solid rgba(10,107,58,0.08)}

  /* Choices (mobile-first) */
  .choices{
    display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:12px 8px;margin-top:14px;justify-items:center;align-items:center
  }
  /* when inside the chat panel make choices a centered, wrapping pill-list */
  .chat-wrap.chat-panel .choices{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;padding:8px 12px;margin-top:6px;z-index:1200}
  .chat-wrap.chat-panel .choices .choice{min-width:140px;max-width:46%;padding:10px 16px;border-radius:18px;background:linear-gradient(180deg,#fff,#f6fff6);border:1px solid #e8f4ea;box-shadow:0 8px 20px rgba(6,60,40,0.04);text-align:center}
  .chat-wrap.chat-panel .choices .choice{white-space:normal}
  .choice{
    padding:12px 18px;border-radius:14px;background:linear-gradient(180deg,#ffffff,#f7fff8);border:1px solid #e6f3ed;cursor:pointer;text-align:center;transition:transform .16s cubic-bezier(.2,.9,.2,1),box-shadow .16s,color .12s,background .12s;
    min-width:120px;max-width:260px;box-shadow:0 6px 18px rgba(6,60,40,0.04);font-weight:600;color:var(--iug-green);
  }
  .choice:hover{transform:translateY(-6px);box-shadow:0 18px 36px rgba(6,60,40,0.06)}
  .choice:active{transform:translateY(-2px);box-shadow:0 8px 20px rgba(6,60,40,0.05)}
  .choice[aria-pressed='true']{background:var(--iug-green);color:#fff;border-color:var(--iug-green);box-shadow:0 14px 34px rgba(10,107,58,0.12)}
  .choice:disabled{opacity:0.6;cursor:not-allowed}
  .choice small{display:block;color:var(--muted);font-weight:400;margin-top:6px}

  /* Chat area */
  .chat-wrap{display:grid;grid-template-rows:auto 1fr auto;gap:10px;padding:14px}
  .progress{display:flex;align-items:center;gap:10px}
  .bar{height:8px;background:#eef6f0;border-radius:999px;overflow:hidden;flex:1}
  .fill{height:100%;background:var(--accent);width:0%;transition:width .2s linear}
  .progress .txt{color:var(--muted);font-size:.92rem}

  .chat{overflow:auto;padding:14px;display:flex;flex-direction:column;gap:12px;background:#fbfffb;border-radius:12px;border:1px solid #f0f5f2}
  .row{display:flex;gap:10px;align-items:flex-end}
  .row.bot{justify-content:flex-start}
  .row.user{justify-content:flex-end}

  .avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#fff,#f6fff6);border:1px solid rgba(10,107,58,0.06);font-size:18px}

  .bubble{padding:10px 12px;border-radius:12px;max-width:78%;box-shadow:0 6px 18px rgba(6,60,40,0.04);animation:pop .16s ease;position:relative}
  .bot .bubble{background:linear-gradient(180deg,#f7fff8,#ffffff);border:1px solid rgba(8,120,60,0.04);color:#0b3b24}
  .user .bubble{background:linear-gradient(180deg,#e8f8ff,#ffffff);border:1px solid rgba(0,140,210,0.06);color:#053047}

  /* grouped messages support */
  .messages{display:flex;flex-direction:column;gap:8px}

  /* message tails */
  .bot .bubble::after, .user .bubble::after{content:'';position:absolute;width:12px;height:12px;transform:rotate(45deg)}
  .bot .bubble::after{right:-6px;bottom:6px;background:linear-gradient(180deg,#f7fff8,#ffffff);border-right:1px solid rgba(8,120,60,0.04);border-bottom:1px solid rgba(8,120,60,0.04)}
  .user .bubble::after{left:-6px;bottom:6px;background:linear-gradient(180deg,#e8f8ff,#ffffff);border-left:1px solid rgba(0,140,210,0.06);border-bottom:1px solid rgba(0,140,210,0.06)}

  /* typing row (inserted into chat) */
  .typing-row{display:flex;gap:10px;align-items:flex-end;opacity:0.92}
  .typing-row .bubble{padding:8px 12px;border-radius:12px;background:linear-gradient(180deg,#fff,#f6fff6);border:1px solid rgba(10,107,58,0.06);color:var(--muted);display:flex;align-items:center;gap:8px}
  .typing-dots{display:flex;gap:6px}
  .typing-dots span{width:8px;height:8px;border-radius:50%;background:rgba(10,107,58,0.16);animation:blink 1s infinite}

  /* subtle avatar pulse when typing */
  .avatar.pulse{animation:avatar-pulse 1.6s infinite}
  @keyframes avatar-pulse{0%{box-shadow:0 0 0 0 rgba(10,107,58,0.12)}50%{box-shadow:0 8px 24px 6px rgba(10,107,58,0.06)}100%{box-shadow:0 0 0 0 rgba(10,107,58,0.0)}}

  .choice:focus{outline:3px solid rgba(7,120,64,0.12);outline-offset:3px}

  /* Phone-like centered chat panel */
  .chat-wrap.chat-panel{max-width:420px;margin:28px auto;background:linear-gradient(180deg,#f9fffb,#ffffff);border-radius:18px;padding:8px;box-shadow:0 20px 50px rgba(10,80,40,0.06)}
  .chat-wrap.chat-panel .progress{padding:6px 6px 0}
  /* make the chat panel position relative so we can place the controls inside it */
  .chat-wrap.chat-panel{position:relative}
  .chat-wrap.chat-panel .chat{height:64vh;min-height:420px;max-height:72vh;padding:18px;padding-bottom:110px;overflow:auto;border-radius:12px}
  /* place controls visually inside the panel at its bottom */
  .chat-wrap.chat-panel .controls{position:absolute;left:12px;right:12px;bottom:12px;padding-top:6px}

  /* sticky input / quick replies bar */
  .input-bar{position:sticky;bottom:0;background:transparent;padding:12px 4px 8px;margin-top:6px;display:flex;justify-content:center;align-items:center}
  .quick-replies{display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
  .quick-replies .choice{padding:10px 18px;border-radius:22px;background:linear-gradient(180deg,#fff,#f6fff6);border:1px solid #eef7ee;box-shadow:0 8px 20px rgba(6,60,40,0.03);min-width:120px;text-align:center;color:var(--iug-green);font-weight:600}

  /* show bubble tail only for last bubble in a row (grouping effect) */
  .row.bot .bubble::after, .row.user .bubble::after{display:block}
  .row.bot .bubble:not(:last-child)::after, .row.user .bubble:not(:last-child)::after{display:none}

  /* user bubble alignment tweak for chat-panel */
  .chat-wrap.chat-panel .row.user{justify-content:flex-end}
  .chat-wrap.chat-panel .row.bot{justify-content:flex-start}

  /* responsive adjustments for choices */
  @media (max-width:720px){
    .choices{grid-template-columns:repeat(2,1fr);gap:10px}
    .choice{min-width:110px}
    .quick-replies .choice{min-width:100px;padding:10px 12px}
  }

  .bubble .meta{display:block;font-size:0.78rem;color:var(--muted);margin-top:6px}
  .timestamp{font-size:0.72rem;color:rgba(20,40,30,0.45);margin-inline-start:8px}

  @keyframes pop{from{transform:translateY(6px) scale(.995);opacity:0}to{transform:none;opacity:1}}

  .typing{display:flex;align-items:center;gap:10px;color:var(--muted);padding:8px;border-radius:12px}
  .dot{width:8px;height:8px;border-radius:50%;background:rgba(10,107,58,0.12);animation:blink 1s infinite}
  .dot:nth-child(2){animation-delay:.12s}
  .dot:nth-child(3){animation-delay:.24s}
  @keyframes blink{0%{transform:translateY(0);opacity:.35}50%{transform:translateY(-4px);opacity:1}100%{transform:translateY(0);opacity:.35}}

  /* fallback for non-chat-panel layout */
  .controls{position:sticky;bottom:0;background:transparent;padding-top:6px}
  /* Actions bar: visually embedded into the chat panel as a rounded footer */
  .actions{display:flex;justify-content:center;gap:12px;margin-top:12px}
  .controls .actions{background:linear-gradient(180deg,#ffffff,#f8fff8);padding:10px;border-radius:14px;border:1px solid rgba(10,107,58,0.04);box-shadow:0 12px 30px rgba(6,60,40,0.04);align-items:center}
  .controls .actions .btn{border-radius:999px;padding:10px 16px;font-size:0.95rem;min-width:120px;box-shadow:none}
  .controls .actions .btn.primary{background:var(--accent);color:#fff;box-shadow:0 8px 22px rgba(10,107,58,0.10)}
  .controls .actions .btn.ghost{background:transparent;color:var(--iug-green);border:1px solid rgba(10,107,58,0.08)}
  @media (max-width:420px){
    .controls .actions{flex-wrap:wrap;gap:8px;padding:8px}
    .controls .actions .btn{min-width:100px;padding:8px 12px;font-size:0.92rem}
  }

  /* Results */
  .results{padding:18px;background:transparent}
  .results h2{text-align:center;color:var(--iug-green);margin-bottom:8px}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:10px}
  .card{background:#fff;border-radius:12px;padding:12px;border:1px solid #f0f5f2}

  /* Responsive tweaks */
  @media (max-width:900px){.features{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:600px){
    .features{grid-template-columns:1fr}
    .hero{height:100px;font-size:32px}
    .container{margin:8px}
    .intro{padding:16px}
    .choices{grid-template-columns:repeat(2,1fr)}
    .avatar{width:32px;height:32px}
  }

  .muted{color:var(--muted)}
</style>
<script>
  // small UI helpers for header status and minimize
  document.addEventListener('DOMContentLoaded', ()=>{
    const botStatus = document.getElementById('botStatus');
    const minBtn = document.getElementById('minimizeChat');
    const chatUI = document.getElementById('chatUI');
    minBtn?.addEventListener('click', ()=>{
      if(chatUI.style.display === 'none'){
        chatUI.style.display='grid'; minBtn.textContent='âˆ’';
      } else {
        chatUI.style.display='none'; minBtn.textContent='+';
      }
    });
    // expose function to update status from typing toggles
    window.__setBotStatus = (s)=>{ if(botStatus) botStatus.textContent = s; };
  });
</script>
</head>
<body>
  <div id="status-bar-placeholder"></div>
<div class="shell">
  <div class="container">
    <!-- INTRO -->
    <section id="intro" class="intro">
  <h1>Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ø°ÙƒÙŠ ğŸ¤–</h1>
  <p>Ø£Ø¯Ø§Ø© Ù…Ø¨ØªÙƒØ±Ø© ØªØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ Ø§Ù„Ø£Ù†Ø³Ø¨ Ø¶Ù…Ù† Ø¨Ø±Ø§Ù…Ø¬ <strong>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø¨ØºØ²Ø©</strong>ØŒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø¥Ø¬Ø§Ø¨Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ø¹Ù„Ù‰ <strong>60 Ø³Ø¤Ø§Ù„Ø§Ù‹</strong> Ù‚ØµÙŠØ±Ø§Ù‹ ÙˆØ¯Ù‚ÙŠÙ‚Ø§Ù‹.</p>
      <div class="hero">ğŸ“</div>
      <div class="features">
  <div class="feature"><h3>ğŸ¯ Ù…Ù†Ù‡Ø¬ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©</h3><p>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ù…ØªØ·Ù„Ø¨Ø§Øª ÙˆØ§Ù‚Ø¹ÙŠØ© ÙˆÙ…Ù‡Ø§Ø±Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ù„ÙƒÙ„ Ù…Ø³Ø§Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ.</p></div>
  <div class="feature"><h3>ğŸ’¬ ØªØ¬Ø±Ø¨Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ©</h3><p>ÙˆØ§Ø¬Ù‡Ø© Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¨Ø³Ø·Ø© ØªØ­Ø§ÙƒÙŠ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©ØŒ Ø³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±.</p></div>
  <div class="feature"><h3>ğŸ“Š ØªÙˆØµÙŠØ§Øª Ù…Ø®ØµØµØ©</h3><p>Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø­Ø³Ø¨ ØªÙˆØ§ÙÙ‚Ù‡Ø§ Ù…Ø¹ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ ÙˆØ¥Ø¬Ø§Ø¨Ø§ØªÙƒ.</p></div>
      </div>
      <div class="center">
  <button id="btnReady" class="btn primary">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ø¢Ù†</button>
      </div>
    </section>

    <!-- CHAT -->
    <section id="chatUI" class="chat-wrap" style="display:none">
      <div class="chat-header" role="region" aria-label="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±">
        <div style="display:flex;align-items:center;gap:12px">
          <div class="avatar" aria-hidden>ğŸ¤–</div>
          <div>
            <div style="font-weight:700;color:var(--iug-green)">Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</div>
              <div id="botStatus" style="font-size:0.86rem;color:var(--muted)">Ù…ØªØµÙ„</div>
          </div>
        </div>
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
          <button id="minimizeChat" class="btn ghost" title="ØªØµØºÙŠØ±">âˆ’</button>
        </div>
      </div>
      <div class="progress">
        <div class="bar"><div id="fill" class="fill"></div></div>
        <div id="progTxt" class="txt"></div>
      </div>

      <div id="chat" class="chat"></div>

      <div class="controls">
      <div id="typing" class="typing" style="display:none">
        <span>Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± ÙŠÙƒØªØ¨...</span>
          <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
        <div id="choices" class="choices"></div>
        <div class="actions">
        <button id="btnBack" class="btn ghost" style="display:none">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
          <button id="btnFinish" class="btn primary" style="display:none">Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØµÙŠØ§Øª</button>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="results" class="results" style="display:none">
      <h2>ØªØ±Ø´ÙŠØ­Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</h2>
      <p id="summary" class="muted" style="text-align:center"></p>
      <div id="cards" class="cards"></div>
      <div class="center" style="margin-top:10px">
        <button id="btnRestart" class="btn primary">ğŸ”„ Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <p class="muted" style="text-align:center;margin-top:6px">ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ù‡ Ø£Ø¯Ø§Ø© Ø¥Ø±Ø´Ø§Ø¯ÙŠØ©ØŒ Ù†Ø§Ù‚Ø´ Ø®ÙŠØ§Ø±Ø§ØªÙƒ Ù…Ø¹ Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ.</p>
    </section>
  
  <!-- Mute toggle (floating) -->
  <button id="ui-sound-toggle" aria-pressed="false" title="ÙƒØªÙ… / ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª" style="position:fixed;left:18px;bottom:18px;z-index:1200;background:linear-gradient(180deg,#fff,#f6fff6);border-radius:999px;padding:8px 12px;border:1px solid rgba(10,107,58,0.08);box-shadow:0 6px 20px rgba(6,60,40,0.06);cursor:pointer">ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª</button>
  </div>
</div>

<script>
  /* =========================
     1) Ø¨Ù†ÙŠØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (60 Ø³Ø¤Ø§Ù„)
     ========================= */
  // 20 Ù…Ø­ÙˆØ± Ã— 3 Ø¨Ù†ÙˆØ¯ = 60 Ø³Ø¤Ø§Ù„. Ù…Ø­Ø§ÙˆØ± Ù…Ø±ØªØ¨Ø·Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ØªØ®ØµØµØ§Øª IUG.
  const DOMAINS = [
    {key:'ai_cs', title:'Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ/Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨', items:[
      'Ø£Ø³ØªÙ…ØªØ¹ Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø´ÙŠÙØ±Ø© ÙˆØ­Ù„Ù‘ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡.',
      'Ø£Ø­Ø¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø·.',
      'Ø£Ù„ØªØ²Ù… Ø¨ØªØ¹Ù„Ù‘Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ù….'
    ]},
    {key:'soft_web', title:'ØªØ·ÙˆÙŠØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Øª/ÙˆÙŠØ¨/Ù…ÙˆØ¨Ø§ÙŠÙ„', items:[
      'Ø£Ø­Ø¨ Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚Ø§Øª ÙˆØ§Ø¬Ù‡Ø§ØªÙ‡Ø§ Ø³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….',
      'Ø£Ø¬ÙŠØ¯ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ù„Ù‰ Ù…Ù‡Ø§Ù… ÙˆØ§Ø¶Ø­Ø©.',
      'Ø§Ù„Ø¹Ù…Ù„ Ø¶Ù…Ù† ÙØ±ÙŠÙ‚ Ø¨Ø±Ù…Ø¬ÙŠ ÙŠÙ†Ø§Ø³Ø¨Ù†ÙŠ.'
    ]},
    {key:'it_media', title:'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª/ÙˆØ³Ø§Ø¦Ø· Ù…ØªØ¹Ø¯Ø¯Ø©', items:[
      'Ø£Ø³ØªÙ…ØªØ¹ Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø£Ù†Ø¸Ù…Ø©/Ø´Ø¨ÙƒØ§Øª ÙˆØ¯Ø¹Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.',
      'Ø£Ø­Ø¨ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ù‚Ù…ÙŠ ÙˆØ§Ù„ØªØµÙ…ÙŠÙ….',
      'Ø£ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø¨Ù‡Ø¯ÙˆØ¡ ÙˆØ­Ù„ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ©.'
    ]},
    {key:'civil', title:'Ù‡Ù†Ø¯Ø³Ø© Ù…Ø¯Ù†ÙŠØ©', items:[
      'Ø£ÙØ¶Ù„ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°.',
      'Ø£Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¦ÙŠØ© ÙˆÙ…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø³Ù„Ø§Ù…Ø©.',
      'Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© ÙŠÙ†Ø§Ø³Ø¨Ø§Ù† Ø·Ø±ÙŠÙ‚ØªÙŠ.'
    ]},
    {key:'arch', title:'Ù‡Ù†Ø¯Ø³Ø© Ù…Ø¹Ù…Ø§Ø±ÙŠØ©/ØªØµÙ…ÙŠÙ… Ø¹Ù…Ø±Ø§Ù†ÙŠ', items:[
      'Ù„Ø¯ÙŠ Ø­Ø³ Ø¨ØµØ±ÙŠ ÙˆØªØµÙ…ÙŠÙ…ÙŠ Ù‚ÙˆÙŠ.',
      'Ø£ÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠØ§Øª ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ÙÙ†ÙŠØ©.',
      'Ø£Ø³ØªÙ…ØªØ¹ Ø¨Ù†Ù…Ø°Ø¬Ø© Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙˆØ§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠ.'
    ]},
    {key:'me_ind', title:'Ù‡Ù†Ø¯Ø³Ø© Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©/ØµÙ†Ø§Ø¹ÙŠØ©', items:[
      'Ø£ÙÙ‡Ù… Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ© ÙˆØ­Ø±ÙƒØªÙ‡Ø§.',
      'Ø£Ù…ÙŠÙ„ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„ÙƒÙØ§Ø¡Ø©.',
      'Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø®ØªØ¨Ø± Ù…Ù…ØªØ¹Ø© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„ÙŠ.'
    ]},
    {key:'ee_comm', title:'Ù‡Ù†Ø¯Ø³Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©/Ø§ØªØµØ§Ù„Ø§Øª', items:[
      'Ø£Ù‡ØªÙ… Ø¨Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ÙˆØ§Ù„Ø¯ÙˆØ§Ø¦Ø±.',
      'Ø£Ø¬Ø¯ Ù…ØªØ¹Ø© ÙÙŠ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØ§Ù„ØªØ­ÙƒÙ….',
      'Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ù„Ù…Ø¹Ù…Ù„ÙŠØ© ØªÙ†Ø§Ø³Ø¨Ù†ÙŠ.'
    ]},
    {key:'sci_math', title:'Ø¹Ù„ÙˆÙ… Ø£Ø³Ø§Ø³ÙŠØ©: Ø±ÙŠØ§Ø¶ÙŠØ§Øª/ÙÙŠØ²ÙŠØ§Ø¡', items:[
      'Ø£Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø±ÙŠØ© ÙˆØ§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¹Ù‚Ù‘Ø¯Ø©.',
      'Ø£Ø­Ø¨ ÙÙ‡Ù… Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„ØªØ¬Ø±ÙŠØ¨.',
      'Ø§Ù„ØªØ¬Ø±ÙŠØ¯ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ Ù„Ø§ ÙŠØ²Ø¹Ø¬Ø§Ù†ÙŠ.'
    ]},
    {key:'sci_chem_bio', title:'Ø¹Ù„ÙˆÙ…: ÙƒÙŠÙ…ÙŠØ§Ø¡/Ø£Ø­ÙŠØ§Ø¡/ØªÙ‚Ù†ÙŠØ© Ø­ÙŠÙˆÙŠØ©', items:[
      'Ø£Ø­Ø¨ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ/Ø§Ù„Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠ.',
      'Ø£Ù‡ØªÙ… Ø¨Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø­ÙŠÙˆÙŠØ© ÙˆØªØ·Ø¨ÙŠÙ‚Ø§ØªÙ‡Ø§.',
      'Ø£Ù„ØªØ²Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„Ø¯Ù‚Ø©.'
    ]},
    {key:'earth_marine', title:'Ø¹Ù„ÙˆÙ…: Ø£Ø±Ø¶/Ø¨Ø­Ø§Ø±/Ø¨ÙŠØ¦Ø©', items:[
      'Ø£Ù‡ØªÙ… Ø¨Ø¹Ù„ÙˆÙ… Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ø¨Ø­Ø§Ø± ÙˆØ§Ù„Ø¨ÙŠØ¦Ø©.',
      'Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ ÙˆØ¬Ù…Ø¹ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª.',
      'Ø£Ø­Ø¨ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø®Ø±Ø§Ø¦Ø· ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©.'
    ]},
    {key:'health', title:'Ø¹Ù„ÙˆÙ… ØµØ­ÙŠØ© (Ø¹Ù„Ø§Ø¬/ØªØµÙˆÙŠØ±/ØªØºØ°ÙŠØ©)', items:[
      'Ø£Ø­Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø§Ø³ ØµØ­ÙŠØ§Ù‹ Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±.',
      'Ø£Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„ØµØ­ÙŠØ© Ø¨Ø¯Ù‚Ø©.',
      'Ø£ØªÙˆØ§ØµÙ„ Ù…Ù‡Ù†ÙŠØ§Ù‹ Ù…Ø¹ Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙˆØ§Ù„ÙÙØ±Ù‚'
    ]},
    {key:'nursing', title:'ØªÙ…Ø±ÙŠØ¶/Ù‚Ø§Ø¨Ù„Ø©', items:[
      'Ø£Ø³ØªØ·ÙŠØ¹ ØªÙ‚Ø¯ÙŠÙ… Ø±Ø¹Ø§ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø³Ø§Ø¹Ø§Øª Ø·ÙˆÙŠÙ„Ø©.',
      'Ø£ØªØ­Ù…Ù„ Ø¶ØºØ· Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø¯Ù‚Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©.',
      'Ø£Ø´Ø¹Ø± Ø¨Ø§Ù„Ø±Ø¶Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.'
    ]},
    {key:'biz', title:'Ø¥Ø¯Ø§Ø±Ø©/Ø§Ù‚ØªØµØ§Ø¯/ØªØ³ÙˆÙŠÙ‚/Ù…Ø­Ø§Ø³Ø¨Ø©/ØªÙ…ÙˆÙŠÙ„', items:[
      'Ø£Ø­Ø¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ ÙˆØ§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø£Ø¹Ù…Ø§Ù„.',
      'Ø£Ù…ÙŠÙ„ Ù„Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ±ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹.',
      'Ø£ØªØ¹Ø§Ù…Ù„ Ø¨Ø±Ø§Ø­Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©.'
    ]},
    {key:'law_sharia', title:'Ø´Ø±ÙŠØ¹Ø© ÙˆÙ‚Ø§Ù†ÙˆÙ†', items:[
      'Ø£Ø­Ø¨ Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†/Ø§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ.',
      'Ø£Ø¨Ù†ÙŠ Ø­Ø¬Ø¬Ø§Ù‹ Ù…Ù†Ø·Ù‚ÙŠØ© ÙˆØ£Ù‚Ù†Ø¹ Ø¨Ù‡Ø§.',
      'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¹Ø¯Ø§Ù„Ø© Ù…Ù‡Ù… Ù„ÙŠ.'
    ]},
    {key:'islamic', title:'Ø£ØµÙˆÙ„ Ø¯ÙŠÙ†/Ø¯Ø¹ÙˆØ© ÙˆØ¥Ø¹Ù„Ø§Ù…', items:[
      'Ø£Ù‡ØªÙ… Ø¨Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠØ© ÙˆØ§Ù„ØªÙØ³ÙŠØ± ÙˆØ§Ù„Ø­Ø¯ÙŠØ«.',
      'Ø£Ø­Ø¨ ØªÙˆØµÙŠÙ„ Ø±Ø³Ø§Ù„Ø© Ù‡Ø§Ø¯ÙØ© Ù„Ù„Ù…Ø¬ØªÙ…Ø¹.',
      'Ø£Ù„ØªØ²Ù… Ø¨Ø§Ù„Ù‚ÙŠÙ… ÙˆØ£Ø±ÙŠØ¯ Ø£Ø«Ø±Ø§Ù‹ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Ù‹.'
    ]},
    {key:'media', title:'Ø¥Ø¹Ù„Ø§Ù…/ØµØ­Ø§ÙØ©/Ø¹Ù„Ø§Ù‚Ø§Øª Ø¹Ø§Ù…Ø©/Ø±Ù‚Ù…ÙŠ', items:[
      'Ø£Ø­Ø¨ ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ§Ù„Ø³Ø±Ø¯ Ø§Ù„Ù‚ØµØµÙŠ.',
      'Ø£Ø¬ÙŠØ¯ Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±.',
      'Ø£Ù…ÙŠÙ„ Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯.'
    ]},
    {key:'lang', title:'Ù„ØºØ§Øª/ØªØ±Ø¬Ù…Ø© (Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)', items:[
      'Ø£Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù„ØºØ§Øª ÙˆØµÙŠØ§ØºØ© Ø§Ù„Ù†ØµÙˆØµ.',
      'Ø£Ø­Ø¨ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨Ø¯Ù‚Ø© ÙˆØ³Ù„Ø§Ø³Ø©.',
      'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ù„ØºÙˆÙŠ ÙˆØ§Ù„Ø£Ø³Ù„ÙˆØ¨ ÙŠÙ‡Ù…Ù†ÙŠ.'
    ]},
    {key:'edu', title:'ØªØ±Ø¨ÙŠØ© ÙˆØªØ¹Ù„ÙŠÙ…', items:[
      'Ø£Ø­Ø¨ Ø§Ù„Ø´Ø±Ø­ ÙˆØªØ¨Ø³ÙŠØ· Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ….',
      'Ø£Ø¯ÙŠØ± ØµÙØ§Ù‹ ÙˆØ£Ù†Ù…Ù‘ÙŠ Ø¯Ø§ÙØ¹ÙŠØ© Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†.',
      'Ø£ØµÙ…Ù… Ø£Ù†Ø´Ø·Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…ØªÙ†ÙˆØ¹Ø©.'
    ]},
    {key:'social', title:'Ø®Ø¯Ù…Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©/Ù…Ø¬ØªÙ…Ø¹', items:[
      'Ø£Ø³Ø§Ù†Ø¯ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø­ØªØ§Ø¬Ø© ÙˆØ£Ø±Ø´Ø¯Ù‡Ù….',
      'Ø£Ø¬ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØ§Ù„ØªØ¹Ø§Ø·Ù.',
      'Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù‡Ù… Ù„ÙŠ.'
    ]},
    {key:'hist_geo_arc', title:'ØªØ§Ø±ÙŠØ®/Ø¬ØºØ±Ø§ÙÙŠØ§/Ø¢Ø«Ø§Ø±', items:[
      'Ø£Ø­Ø¨ Ø¯Ø±Ø§Ø³Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«.',
      'Ø£Ù‡ØªÙ… Ø¨Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§ ÙˆÙ†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©.',
      'ÙŠÙ†Ø§Ø³Ø¨Ù†ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ.'
    ]},
  ];
  // Ù…Ø³Ø·Ù‘Ø­: 60 Ø¨Ù†Ø¯
  const ITEMS = DOMAINS.flatMap(d=>d.items.map(t=>({t,key:d.key})));
  const TOTAL = ITEMS.length;

  /* =========================
     2) Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
     ========================= */
     
  const intro   = document.getElementById('intro');
  const btnReady= document.getElementById('btnReady');

  const chatUI  = document.getElementById('chatUI');
  const chat    = document.getElementById('chat');
  const choices = document.getElementById('choices');
  const typing  = document.getElementById('typing');
  const btnBack = document.getElementById('btnBack');
  const btnFinish=document.getElementById('btnFinish');
  const fill    = document.getElementById('fill');
  const progTxt = document.getElementById('progTxt');

  const results = document.getElementById('results');
  const summary = document.getElementById('summary');
  const cards   = document.getElementById('cards');
  const btnRestart = document.getElementById('btnRestart');

  /* =========================
     3) Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
     ========================= */
  let idx = 0;                  // ÙÙ‡Ø±Ø³ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
  const responses = {};         // index -> 1..5
  // Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙˆØ¬Ø²Ø© Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØµÙŠØ§Øª)
  const profile = { branch: null, tawjihi: null };

  /* =========================
     4) Ø£Ø¯ÙˆØ§Øª Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
     ========================= */
  function scrollChat(){ chat.scrollTop = chat.scrollHeight; }
  function addBot(text){
    // try to group with previous bot message when recent
    const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    const last = chat.lastElementChild;
    if(last && last.classList.contains('row') && last.classList.contains('bot')){
      // append as a following bubble for grouped look
      const bubble = document.createElement('div'); bubble.className='bubble';
      bubble.innerHTML = `${text}<span class="meta"><span class="timestamp">${time}</span></span>`;
      last.appendChild(bubble);
      animateIn(bubble);
      scrollChat();
      return;
    }
    const row = document.createElement('div'); row.className='row bot';
    row.innerHTML = `<div class="avatar" aria-hidden>ğŸ¤–</div><div class="bubble">${text}<span class="meta"><span class="timestamp">${time}</span></span></div>`;
    chat.appendChild(row);
    animateIn(row);
    scrollChat();
  }
  function addUser(text){
    const row = document.createElement('div'); row.className='row user';
    const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    row.innerHTML = `<div class="bubble">${text}<span class="meta"><span class="timestamp">${time}</span></span></div>`;
    chat.appendChild(row);
    animateIn(row);
    scrollChat();
  }

  function showTypingRow(show){
    // insert a typing-row element into chat for realism
    let tr = chat.querySelector('.typing-row');
    if(show){
      if(!tr){
        tr = document.createElement('div'); tr.className='row bot typing-row';
        tr.innerHTML = `<div class="avatar">ğŸ¤–</div><div class="bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>`;
        chat.appendChild(tr);
        scrollChat();
      }
      // add pulse to the last avatar (the bot avatar)
      const avs = chat.querySelectorAll('.row.bot .avatar'); if(avs.length) avs[avs.length-1].classList.add('pulse');
      try{ if(window.__setBotStatus) window.__setBotStatus('ÙŠÙƒØªØ¨...'); }catch(e){}
    } else {
      if(tr) tr.remove();
      // remove pulse from any bot avatars
      const avs2 = chat.querySelectorAll('.row.bot .avatar.pulse'); avs2.forEach(x=>x.classList.remove('pulse'));
      try{ if(window.__setBotStatus) window.__setBotStatus('Ù…ØªØµÙ„'); }catch(e){}
    }
  }

  function animateIn(el){
    try{
      if(window.gsap && typeof window.gsap.from === 'function'){
        window.gsap.from(el, {y:8,opacity:0,duration:0.36,ease:'power2.out'});
      } else {
        // fallback: add slight opacity transition
        el.style.transition = 'opacity .28s, transform .28s';
        el.style.opacity = '0'; el.style.transform = 'translateY(8px)';
        requestAnimationFrame(()=>{ el.style.opacity='1'; el.style.transform='none'; });
      }
    }catch(e){/* ignore animation errors */}
  }
  function showTyping(show){ typing.style.display = show ? 'flex' : 'none'; }

  function updateProgress(){
    const answered = Object.keys(responses).length;
    const pct = Math.round(answered / TOTAL * 100);
    fill.style.width = pct + '%';
    progTxt.textContent = `ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ ${answered}/${TOTAL} (${pct}Ùª)`;
  }

  function setChoicesEnabled(enabled){
    const btns = Array.from(choices.querySelectorAll('.choice'));
    btns.forEach(b=>{ b.disabled = !enabled; });
  }

  function renderChoices(){
    choices.innerHTML = '';
    const labels = ['1 Ù„Ø§ ÙŠÙ†Ø·Ø¨Ù‚','2 ÙŠÙ†Ø·Ø¨Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹','3 Ù…Ø­Ø§ÙŠØ¯','4 ÙŠÙ†Ø·Ø¨Ù‚','5 ÙŠÙ†Ø·Ø¨Ù‚ Ø¬Ø¯Ù‘Ø§Ù‹'];
    labels.forEach((lbl, i)=>{
      const b = document.createElement('button');
      b.className='choice'; b.textContent=lbl; b.setAttribute('role','button');
      b.setAttribute('aria-pressed','false');
      b.onclick = ()=>{ choose(i); };
      choices.appendChild(b);
    });
    // keyboard support: 1..5 to choose
    function onKey(e){
      if(document.activeElement && document.activeElement.tagName==='INPUT') return;
      const k = e.key;
      if(/[1-5]/.test(k)){
        const n = parseInt(k,10)-1;
        choose(n);
      }
    }
    function choose(i){
      // disable while typing
      if(typing.style.display !== 'none') return;
      const btns = Array.from(choices.querySelectorAll('.choice'));
      const b = btns[i]; if(!b) return;
      btns.forEach(x=>x.setAttribute('aria-pressed','false'));
      b.setAttribute('aria-pressed','true');
      const val = i+1;
      responses[idx] = val;
      addUser(labels[i]);
      idx++;
      updateProgress();
      window.removeEventListener('keydown', onKey);
      if(idx < TOTAL) {
        nextQuestion();
      } else {
        endQuestions();
      }
    }
    window.addEventListener('keydown', onKey);
    btnBack.style.display = idx>0 ? 'inline-block' : 'none';
  }

  // --- profile collection UI: branch (Ø£Ø¯Ø¨ÙŠ/Ø¹Ù„Ù…ÙŠ) + ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠ ---
  function showProfileForm(){
    choices.innerHTML = '';
    // extended branch list per user request
    const branches = [
      {id:'sci', label:'Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø¹Ù„Ù…ÙŠ'},
      {id:'arts', label:'Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£Ø¯Ø¨ÙŠ'},
      {id:'sharia', label:'Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø´Ø±Ø¹ÙŠ'},
      {id:'biz', label:'Ø§Ù„ÙØ±Ø¹ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ (Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø§Ù‚ØªØµØ§Ø¯)'},
      {id:'industrial', label:'Ø§Ù„ÙØ±Ø¹ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ'},
      {id:'it', label:'ÙØ±Ø¹ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (IT)'},
      {id:'agri', label:'Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ'},
      {id:'hotel', label:'Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙÙ†Ø¯Ù‚ÙŠ ÙˆØ§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ù…Ù†Ø²Ù„ÙŠ'}
    ];
    const grid = document.createElement('div');
    grid.style.display = 'flex'; grid.style.flexWrap = 'wrap'; grid.style.gap = '10px'; grid.style.justifyContent = 'center';
    branches.forEach(b=>{
      const btn = document.createElement('button'); btn.className='choice'; btn.textContent = b.label; btn.style.minWidth='160px';
      btn.onclick = ()=>{
        profile.branch = b.id;
        addUser(b.label);
        // then ask for tawjihi grade
        renderTawjihiInput();
      };
      grid.appendChild(btn);
    });
    choices.appendChild(grid);
    // helper: render numeric input for Tawjihi
    function renderTawjihiInput(){
      choices.innerHTML = '';
      const wrap = document.createElement('div'); wrap.style.display='flex'; wrap.style.flexDirection='column'; wrap.style.alignItems='center'; wrap.style.gap='8px';
      const label = document.createElement('div'); label.textContent = 'Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠ (Ù…Ø«Ø§Ù„: 85)'; label.className='muted';
      const input = document.createElement('input'); input.type='number'; input.min='0'; input.max='100'; input.style.padding='8px 10px'; input.style.borderRadius='8px'; input.style.border='1px solid #e6f3ed'; input.style.width='160px';
      const ok = document.createElement('button'); ok.className='choice'; ok.textContent='Ø­ÙØ¸ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©';
      ok.onclick = ()=>{
        const v = parseFloat(input.value);
        profile.tawjihi = Number.isFinite(v) ? v : null;
        addUser(profile.tawjihi ? `${profile.tawjihi}` : 'Ù„Ù… Ø£Ø­Ø¯Ø¯');
        choices.innerHTML='';
        updateProgress();
        askQuestion();
      };
      wrap.appendChild(label); wrap.appendChild(input); wrap.appendChild(ok);
      choices.appendChild(wrap);
      input.focus();
    }
  }

  function askQuestion(){
    const q = ITEMS[idx];
  // bot 'typing' then show question
  showTypingRow(true); setChoicesEnabled(false);
  setTimeout(()=>{
      showTyping(false);
    showTypingRow(false);
    addBot(`Ø³Ø¤Ø§Ù„ ${idx+1} Ù…Ù† ${TOTAL}: ${q.t}`);
      renderChoices();
      setChoicesEnabled(true);
    }, 420 + Math.min(900, ITEMS[idx].t.length*8));
  }

  function nextQuestion(){
  choices.innerHTML = ''; showTyping(true); setChoicesEnabled(false);
  setTimeout(()=>{ showTypingRow(false); askQuestion(); }, 420);
  }

  function startChat(){
    intro.style.display='none';
  chatUI.style.display='grid';
  chatUI.classList.add('chat-panel');
    chat.innerHTML=''; choices.innerHTML='';
    // Start greeting and ask for readiness before first question
    showTypingRow(true);
    setTimeout(()=>{ showTypingRow(false); addBot('Ù…Ø±Ø­Ø¨Ù‹Ø§ â€” ÙŠØ³Ø¹Ø¯Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©.'); }, 260);
    setTimeout(()=>{
      // show the readiness prompt (separated function so it can be 'retracted')
      showReadyPrompt();
    }, 700);
  }

  // show the ready / not now prompt; can be called again by a 'ØªØ±Ø§Ø¬Ø¹' button
  function showReadyPrompt(){
    addBot('Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØªÙƒÙˆÙ‘Ù† Ù…Ù† 60 Ø³Ø¤Ø§Ù„Ù‹Ø§ Ù‚ØµÙŠØ±Ø© ÙˆØ³Ø±ÙŠØ¹Ø©. Ù‡Ù„ ØªÙˆØ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù†ØŸ');
    choices.innerHTML = '';
    const yes = document.createElement('button'); yes.className='choice'; yes.textContent='Ù†Ø¹Ù…ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†';
    const no = document.createElement('button'); no.className='choice'; no.textContent='Ù„Ø§ØŒ Ù„Ø§Ø­Ù‚Ù‹Ø§';
    yes.onclick = ()=>{ addUser('Ù†Ø¹Ù…ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†'); choices.innerHTML=''; showProfileForm(); };
    no.onclick = ()=>{
      addUser('Ù„Ø§ØŒ Ù„Ø§Ø­Ù‚Ù‹Ø§');
      addBot('Ø­Ø³Ù†Ù‹Ø§. Ø¹Ø¯ Ù…ØªÙ‰ Ø´Ø¦ØªØŒ ÙˆØ³Ø£ÙƒÙˆÙ† Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ.');
      // offer a retract button so user can go back to the readiness prompt
      choices.innerHTML = '';
      const back = document.createElement('button'); back.className='choice'; back.textContent='ØªØ±Ø§Ø¬Ø¹';
      const keep = document.createElement('button'); keep.className='choice'; keep.textContent='Ù„Ø§ Ø£Ø±ÙŠØ¯ Ø§Ù„Ø¢Ù†';
      back.onclick = ()=>{ choices.innerHTML=''; showReadyPrompt(); };
      keep.onclick = ()=>{ choices.innerHTML=''; };
      choices.appendChild(back); choices.appendChild(keep);
    };
    choices.appendChild(yes); choices.appendChild(no);
  }

  btnReady.onclick = startChat;

  btnBack.onclick = ()=>{
    if(idx>0){
      delete responses[idx-1];
      idx = idx-1;
      chat.innerHTML='';
      addBot('Ø­Ø³Ù†Ø§Ù‹ØŒ Ø±Ø¬Ø¹Ù†Ø§Ùƒ Ø®Ø·ÙˆØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.');
      updateProgress();
      askQuestion();
    }
  };

  function endQuestions(){
    showTypingRow(true); setChoicesEnabled(false);
    setTimeout(()=>{
      showTypingRow(false);
      addBot('Ø£Ø­Ø³Ù†Øª! Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. Ø¬Ø§Ù‡Ø² ØªØ´ÙˆÙ ØªÙˆØµÙŠØ§ØªÙŠØŸ');
      btnFinish.style.display='inline-block';
      choices.innerHTML='';
    }, 500);
  }

  /* =========================
     5) Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬
     ========================= */
  // Ø¨Ø±Ø§Ù…Ø¬ IUG ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ù…Ø­Ø§ÙˆØ± (Ø£ÙˆØ²Ø§Ù† ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆØ§Ù‚Ø¹ÙŠØ©)
  const MAJORS = [
    // IT & CS
    {id:'ai_cs',    name:'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨/Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ¹Ù„ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', dom:{ai_cs:1.0,soft_web:0.8,sci_math:0.6}, note:'Ø£Ø³Ø§Ø³ Ø±ÙŠØ§Ø¶ÙŠØ§Øª/Ù…Ù†Ø·Ù‚ Ù‚ÙˆÙŠ ÙˆØªØ¹Ù„Ù… Ø°Ø§ØªÙŠ Ù…Ø³ØªÙ…Ø±.'},
    {id:'sw',       name:'ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª/Ø§Ù„ÙˆÙŠØ¨ ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„',         dom:{soft_web:1.0,ai_cs:0.6,it_media:0.5}, note:'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø·ÙˆÙŠÙ„Ø© ÙˆØªØ¹Ø§ÙˆÙ† ÙØ±ÙŠÙ‚ Ø¨Ø±Ù…Ø¬ÙŠ.'},
    {id:'it',       name:'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª/ÙˆØ³Ø§Ø¦Ø· Ù…ØªØ¹Ø¯Ø¯Ø©',        dom:{it_media:1.0,soft_web:0.5,media:0.4}, note:'ØªØ¹Ø§Ù…Ù„ Ø¹Ù…Ù„ÙŠ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰.'},

    // Ù‡Ù†Ø¯Ø³Ø©
    {id:'civil',    name:'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©',                           dom:{civil:1.0,sci_math:0.5}, note:'Ù…ÙŠØ¯Ø§Ù†ÙŠ + Ø­Ø³Ø§Ø¨Ø§Øª ÙˆÙ…Ø¹Ø§ÙŠÙŠØ± Ø³Ù„Ø§Ù…Ø©.'},
    {id:'arch',     name:'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©/ØªØµÙ…ÙŠÙ… Ø¹Ù…Ø±Ø§Ù†ÙŠ',           dom:{arch:1.0,civil:0.6,media:0.4}, note:'Ø°Ø§Ø¦Ù‚Ø© Ø¨ØµØ±ÙŠØ© ÙˆÙÙ‡Ù… ØªÙ‚Ù†ÙŠ.'},
    {id:'me_ind',   name:'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©/Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©',             dom:{me_ind:1.0,sci_math:0.5}, note:'ØªÙÙƒÙŠØ± Ù†Ø¸Ø§Ù…ÙŠ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…Ù„ÙŠ ÙˆØªØ­Ø³ÙŠÙ† ÙƒÙØ§Ø¡Ø©.'},
    {id:'ee',       name:'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©/Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª',             dom:{ee_comm:1.0,sci_math:0.6}, note:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª/ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ÙˆÙ‚ÙŠØ§Ø³Ø§Øª.'},

    // Ø¹Ù„ÙˆÙ…
    {id:'math_phys',name:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª/ÙÙŠØ²ÙŠØ§Ø¡',                           dom:{sci_math:1.0,ai_cs:0.5}, note:'ØªØ¬Ø±ÙŠØ¯ ÙˆØªØ­Ù„ÙŠÙ„ Ø¹Ø§Ù„ÙŠØ§Ù†.'},
    {id:'chem_bio_biotech',name:'ÙƒÙŠÙ…ÙŠØ§Ø¡/Ø£Ø­ÙŠØ§Ø¡/ØªÙ‚Ù†ÙŠØ© Ø­ÙŠÙˆÙŠØ©',          dom:{sci_chem_bio:1.0,health:0.4}, note:'Ø¯Ù‚Ø© Ù…Ø®Ø¨Ø±ÙŠØ© ÙˆØ§Ù‡ØªÙ…Ø§Ù… Ø¨Ø§Ù„Ø¨Ø­Ø«.'},
    {id:'earth_marine',name:'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ø¨Ø­Ø§Ø± ÙˆØ§Ù„Ø¨ÙŠØ¦Ø©',             dom:{earth_marine:1.0}, note:'Ø¹Ù…Ù„ Ù…ÙŠØ¯Ø§Ù†ÙŠ ÙˆØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ¦ÙŠ.'},

    // ØµØ­ÙŠØ© ÙˆØªÙ…Ø±ÙŠØ¶
    {id:'health',   name:'Ø¹Ù„ÙˆÙ… ØµØ­ÙŠØ© (Ø¹Ù„Ø§Ø¬/ØªØµÙˆÙŠØ±/ØªØºØ°ÙŠØ©)',            dom:{health:1.0,sci_chem_bio:0.5}, note:'ØªÙˆØ§ØµÙ„ Ø¥Ù†Ø³Ø§Ù†ÙŠ ÙˆØ¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª ÙˆØ§Ø¶Ø­Ø©.'},
    {id:'nursing',  name:'Ø§Ù„ØªÙ…Ø±ÙŠØ¶/Ø§Ù„Ù‚Ø§Ø¨Ù„Ø©',                           dom:{nursing:1.0,health:0.6}, note:'Ø±Ø¹Ø§ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆØªØ­Ù…Ù„ Ø¶ØºØ·.'},
    {id:'med',      name:'Ø§Ù„Ø·Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠ',                                dom:{health:0.8,sci_chem_bio:0.8}, note:'Ø£Ø³Ø§Ø³ Ø¹Ù„Ù…ÙŠ Ù‚ÙˆÙŠ ÙˆØ§Ù„ØªØ²Ø§Ù… Ø·ÙˆÙŠÙ„.'},

    // Ø§Ù‚ØªØµØ§Ø¯ ÙˆØ¥Ø¯Ø§Ø±Ø©
    {id:'biz',      name:'Ø¥Ø¯Ø§Ø±Ø©/Ø§Ù‚ØªØµØ§Ø¯/ØªØ³ÙˆÙŠÙ‚/Ù…Ø­Ø§Ø³Ø¨Ø©/ØªÙ…ÙˆÙŠÙ„',         dom:{biz:1.0,soft_web:0.3,ai_cs:0.3}, note:'Ø£Ø³ÙˆØ§Ù‚ ÙˆÙ‚ÙŠØ§Ø¯Ø© ÙˆØªØ­Ù„ÙŠÙ„ Ù…Ø§Ù„ÙŠ.'},

    // Ø´Ø±ÙŠØ¹Ø© ÙˆÙ‚Ø§Ù†ÙˆÙ† ÙˆØ£ØµÙˆÙ„ Ø¯ÙŠÙ†
    {id:'law_sharia',name:'Ø§Ù„Ø´Ø±ÙŠØ¹Ø© ÙˆØ§Ù„Ù‚Ø§Ù†ÙˆÙ†',                          dom:{law_sharia:1.0}, note:'Ø§Ù„ØªØ²Ø§Ù… Ø£Ù†Ø¸Ù…Ø© ÙˆØ¨Ù†Ø§Ø¡ Ø­Ø¬Ø¬.'},
    {id:'islamic',  name:'Ø£ØµÙˆÙ„ Ø¯ÙŠÙ†/Ø¯Ø¹ÙˆØ© ÙˆØ¥Ø¹Ù„Ø§Ù…',                      dom:{islamic:1.0,media:0.4}, note:'Ø¹Ù„ÙˆÙ… Ø´Ø±Ø¹ÙŠØ© ÙˆØªØ£Ø«ÙŠØ± Ù…Ø¬ØªÙ…Ø¹ÙŠ.'},

    // Ø¢Ø¯Ø§Ø¨/Ø¥Ø¹Ù„Ø§Ù…/Ù„ØºØ§Øª
    {id:'media',    name:'Ø¥Ø¹Ù„Ø§Ù…/ØµØ­Ø§ÙØ©/Ø¹Ù„Ø§Ù‚Ø§Øª Ø¹Ø§Ù…Ø©/Ø±Ù‚Ù…ÙŠ',             dom:{media:1.0,it_media:0.4}, note:'Ø³Ø±Ø¯ Ù‚ØµØµÙŠ ÙˆØªÙˆØ§ØµÙ„ Ø±Ù‚Ù…ÙŠ.'},
    {id:'lang',     name:'Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©/ØªØ±Ø¬Ù…Ø©/ØªØ¯Ù‚ÙŠÙ‚ Ù„ØºÙˆÙŠ',      dom:{lang:1.0}, note:'Ø´ØºÙ Ø¨Ø§Ù„Ù„ØºØ© ÙˆØ¯Ù‚Ø© Ø§Ù„Ø£Ø³Ù„ÙˆØ¨.'},

    // ØªØ±Ø¨ÙŠØ© ÙˆØ®Ø¯Ù…Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ÙˆØªØ§Ø±ÙŠØ®/Ø¬ØºØ±Ø§ÙÙŠØ§/Ø¢Ø«Ø§Ø±
    {id:'edu',      name:'ØªØ±Ø¨ÙŠØ©/ØªØ¹Ù„ÙŠÙ… (Ø£Ø³Ø§Ø³ÙŠ/Ù…ÙˆØ§Ø¯)',                dom:{edu:1.0,lang:0.3}, note:'ØªØ¨Ø³ÙŠØ· Ù…ÙØ§Ù‡ÙŠÙ… ÙˆØ¥Ø¯Ø§Ø±Ø© ØµÙ.'},
    {id:'social',   name:'Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',                         dom:{social:1.0}, note:'ØªØ¹Ø§Ø·Ù ÙˆØ¥Ø±Ø´Ø§Ø¯ Ù…Ø¬ØªÙ…Ø¹ÙŠ.'},
    {id:'hist_geo_arc',name:'ØªØ§Ø±ÙŠØ®/Ø¬ØºØ±Ø§ÙÙŠØ§/Ø¢Ø«Ø§Ø±',                     dom:{hist_geo_arc:1.0}, note:'Ø¨Ø­Ø« ÙˆØªØ­Ù„ÙŠÙ„ ÙˆØ£Ø¹Ù…Ø§Ù„ Ù…ÙŠØ¯Ø§Ù†ÙŠØ©.'},
  ];

  function computeNormScores(){
    const sums = {}; const counts = {};
    DOMAINS.forEach(d=>{ sums[d.key]=0; counts[d.key]=d.items.length; });
    ITEMS.forEach((item,i)=>{ const v = responses[i]||0; sums[item.key]+=v; });
    const norm = {};
    for(const k in sums){ norm[k] = sums[k] / (counts[k]*5); } // 0..1
    return norm;
  }

  function rankMajors(norm){
    const ranked = MAJORS.map(m=>{
      let s=0;
      for(const k in m.dom){ s += (m.dom[k]||0) * (norm[k]||0); }
      // Ù‚ÙˆØ§Ø¹Ø¯ ÙˆØ§Ù‚Ø¹ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©:
      // Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© (ØªØ£Ø«ÙŠØ± ÙˆØ§Ø¶Ø­ Ù„Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø·Ù„Ø¨ Ø°Ù„Ùƒ)
      const branch = profile.branch;
      if(branch){
        // Ù…Ø¹Ø§Ù…Ù„Ø© Ø¹Ø§Ù…Ø©: Ø¯ÙØ¹Ø§Øª/ØªØ®ÙÙŠØ¶Ø§Øª Ù…Ø¹Ù‚ÙˆÙ„Ø© Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ø¹
        if(branch === 'arts'){
          if(['med','ee','me_ind','civil','math_phys','ai_cs'].includes(m.id)) s -= 0.09;
          if(['lang','media','edu','hist_geo_arc','social'].includes(m.id)) s += 0.06;
        }
        if(branch === 'sci'){
          if(['med','ee','me_ind','civil','math_phys','chem_bio_biotech','ai_cs'].includes(m.id)) s += 0.08;
        }
        if(branch === 'sharia'){
          if(['law_sharia','islamic'].includes(m.id)) s += 0.10;
        }
        if(branch === 'biz'){
          if(['biz','media','lang'].includes(m.id)) s += 0.08;
        }
        if(branch === 'industrial'){
          if(['me_ind','ee','civil'].includes(m.id)) s += 0.09;
        }
        if(branch === 'it'){
          if(['ai_cs','soft_web','it'].includes(m.id) || ['it'].includes(m.id)) s += 0.12;
          if(['it','sw','ai_cs'].includes(m.id)) s += 0.02; // small extra for related
        }
        if(branch === 'agri'){
          if(['earth_marine','chem_bio_biotech','health'].includes(m.id)) s += 0.07;
        }
        if(branch === 'hotel'){
          if(['biz','social','media'].includes(m.id)) s += 0.06;
        }
      }
      if(m.id==='med' && !(norm.health>0.7 && norm.sci_chem_bio>0.7)) s -= 0.15;
      if(['ee','me_ind','civil'].includes(m.id) && norm.sci_math<0.45) s -= 0.08;
      if(m.id==='arch' && norm.arch<0.5) s -= 0.08;
      if(m.id==='ai_cs' && norm.ai_cs<0.5) s -= 0.08;
      // ØªØ¹Ø¯ÙŠÙ„ Ø£ÙƒØ¨Ø± Ø­Ø³Ø¨ ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠ Ù„Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙƒØ¯ Ø£Ù‡Ù…ÙŠØªÙ‡
      if(profile.tawjihi){
        const g = profile.tawjihi;
        if(g >= 95) s += 0.08;
        else if(g >= 90) s += 0.06;
        else if(g >= 80) s += 0.03;
        else if(g < 60) s -= 0.06;
      }
      return {...m, score: Math.max(0, s)};
    }).sort((a,b)=>b.score-a.score);
    return ranked;
  }

  function topDomainStr(norm){
    const top = Object.entries(norm).sort((a,b)=>b[1]-a[1]).slice(0,3);
    const label = k => (DOMAINS.find(d=>d.key===k)?.title || k);
    return top.map(([k,v])=>`${label(k)} (${Math.round(v*100)}Ùª)`).join(' â€¢ ');
  }

  function showResults(){
    const answered = Object.keys(responses).length;
  if(answered < TOTAL){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØµÙŠØ§Øª.'); return; }
    const norm = computeNormScores();
    const ranked = rankMajors(norm);
    // Ù…Ù„Ø®Øµ
  summary.textContent = `Ø£Ø¨Ø±Ø² Ù…Ø¬Ø§Ù„Ø§Øª Ù…Ù„Ø§Ø¡ØªÙƒ: ${topDomainStr(norm)}. ÙÙŠÙ…Ø§ ÙŠÙ„ÙŠ ØªØ±Ø´ÙŠØ­Ø§Øª Ù…Ø¨Ø¯Ø¦ÙŠØ© Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø¨ØºØ²Ø©:`;
    // Ø¨Ø·Ø§Ù‚Ø§Øª
    cards.innerHTML='';
    ranked.slice(0,8).forEach(m=>{
      const topTags = Object.keys(m.dom).map(k=>DOMAINS.find(d=>d.key===k)?.title || k).slice(0,3).join('ØŒ ');
      const div = document.createElement('div');
      div.className='card';
        div.innerHTML = `
        <div style="font-weight:700">${m.name}</div>
        <div class="muted">Ù…Ø­Ø§ÙˆØ± Ø¨Ø§Ø±Ø²Ø©: ${topTags}</div>
        <div class="tag">Ù…Ø¯Ù‰ Ø§Ù„Ù…Ù„Ø§Ø¡Ù…Ø©: ${Math.round(m.score*100)}%</div>
        <div style="margin-top:6px">${m.note}</div>
        ${m.id==='med' ? '<div class="muted" style="margin-top:6px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµ ÙŠØªØ·Ù„Ø¨ ØªØ­ØµÙŠÙ„Ù‹Ø§ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠÙ‹Ø§ Ù‚ÙˆÙŠÙ‹Ø§ ÙˆÙ…Ø¯Ø© Ø¯Ø±Ø§Ø³Ø© Ø·ÙˆÙŠÙ„Ø©.</div>' : ''}
      `;
      cards.appendChild(div);
    });
    chatUI.style.display='none';
    // ensure results visible and not covered by the fixed status bar
    results.style.display='block';
    // compute offset caused by the status bar (if present)
    (function ensureVisible(){
      try{
        const statusBar = document.getElementById('status-bar');
        const placeholder = document.getElementById('status-bar-placeholder');
        let offset = 0;
        if (statusBar){
          // Use its offsetHeight; if it's hidden the placeholder may carry the height
          offset = statusBar.offsetHeight || (placeholder ? placeholder.offsetHeight : 0);
        } else if (placeholder){
          offset = placeholder.offsetHeight || 0;
        }
        // Add a small margin so the content isn't flush under the bar
        const margin = 12;
        results.style.position = results.style.position || 'relative';
        results.style.zIndex = results.style.zIndex || '1100';
        results.style.scrollMarginTop = (offset + margin) + 'px';
        const top = results.getBoundingClientRect().top + window.scrollY - offset - margin;
        window.scrollTo({ top: Math.max(0, top), behavior: 'smooth' });
      }catch(e){ window.scrollTo({top:0,behavior:'smooth'}); }
    })();
  }

  btnFinish.onclick = showResults;
  btnRestart.onclick = ()=>{
    idx=0; for(const k in responses) delete responses[k];
    results.style.display='none';
    // Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ù‚Ø¯Ù…Ø©
    intro.style.display='grid';
    fill.style.width='0%'; progTxt.textContent='';
    window.scrollTo({top:0,behavior:'smooth'});
  };
  
btnRestart.onclick = ()=>{
  idx=0; for(const k in responses) delete responses[k];
  results.style.display='none';
  intro.style.display='grid';
  chatUI.classList.remove('chat-panel');
  fill.style.width='0%'; progTxt.textContent='';
  window.scrollTo({top:0,behavior:'smooth'});
};

  /* ====== Ù…Ø¤Ø«Ø±Ø§Øª ØµÙˆØªÙŠØ© Ø¨Ø³ÙŠØ·Ø© ====== */
const ctx = new (window.AudioContext||window.webkitAudioContext)();
window.uiMuted = localStorage.getItem('iug-ui-muted') === '1';
function beep({freq=500,dur=0.1,type='sine'}={}) {
  if (window.uiMuted) return; // respect mute
  if(!ctx) return;
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.type=type; o.frequency.value=freq;
  o.connect(g); g.connect(ctx.destination);
  g.gain.value=0.05;
  o.start(); o.stop(ctx.currentTime+dur);
}

/* Ø£ØµÙˆØ§Øª */
const sfx = {
  msg: ()=>beep({freq:520,dur:.1,type:'triangle'}),
  click: ()=>beep({freq:420,dur:.08,type:'square'}),
  success: ()=>{ beep({freq:500}); setTimeout(()=>beep({freq:760}),80); }
};

/* Ø±Ø¨Ø· Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« */
const origAddBot = addBot;
addBot = function(txt){
  origAddBot(txt);
  sfx.msg();
};

const origAddUser = addUser;
addUser = function(txt){
  origAddUser(txt);
  sfx.click();
};

const origShowResults = showResults;
showResults = function(){
  origShowResults();
  sfx.success();
};

// UI mute toggle button
document.addEventListener('DOMContentLoaded', ()=>{
  const toggle = document.getElementById('ui-sound-toggle');
    function updateToggle(){
    if (!toggle) return;
    toggle.setAttribute('aria-pressed', window.uiMuted ? 'true' : 'false');
    toggle.textContent = window.uiMuted ? 'ğŸ”ˆ Ù…ÙƒØªÙˆÙ…' : 'ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª';
  }
  updateToggle();
  toggle.addEventListener('click', ()=>{
    // resume AudioContext on first interaction
    try{ if (ctx.state === 'suspended') ctx.resume(); }catch(e){}
    window.uiMuted = !window.uiMuted;
    localStorage.setItem('iug-ui-muted', window.uiMuted ? '1' : '0');
    updateToggle();
  });
});

</script>

<script defer="True" src="assets/js/statusBar.js"></script>
<!-- GSAP for micro-animations -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

</body>
</html>

<!-- inline audio fallback (optional element) -->
<audio id="transition-sound" preload="auto" src="assets/sounds/turning.mp3"></audio>
