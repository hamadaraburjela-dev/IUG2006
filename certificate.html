<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø±Ø­Ù„Ø©</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&amp;family=Marhey:wght@500&amp;display=swap" rel="stylesheet"/>
<audio id="success-audio" preload="auto" src="assets/sounds/nashed.mp3"></audio>
<style>
  :root {
    --primary-color: #004d40; /* Deep Teal */
    --secondary-color: #bcaaa4; /* Light Brown/Gold Accent */
    --text-color: #333;
    --bg-color: #f9f9f7;
  }
  body {
    font-family: "Cairo", sans-serif;
    background: var(--bg-color);
    text-align: center;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #printable-certificate {
    width: 800px;
    background: white;
    border: 10px solid var(--primary-color);
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    position: relative;
    background-image: url('assets/images/logo-watermark.webp'); /* Optional: Add a light watermark */
    background-repeat: no-repeat;
    background-position: center;
    background-size: 400px;
  }
  .cert-border {
    border: 2px solid var(--secondary-color);
    padding: 20px;
  }
  .cert-header {
    margin-bottom: 25px;
  }
  .cert-header img {
    width: 120px;
    margin-bottom: 10px;
  }
  .cert-header h1 {
    font-family: 'Marhey', cursive;
    font-size: 2.5rem;
    color: var(--primary-color);
    margin: 0;
  }
  .cert-header h2 {
    font-size: 1.5rem;
    color: var(--text-color);
    margin: 5px 0;
  }
  .cert-body .intro-text {
    font-size: 1.2rem;
    margin: 20px 0 5px 0;
  }
  .cert-body .student-name {
    font-family: 'Marhey', cursive;
    font-size: 2.2rem;
    color: var(--primary-color);
    margin: 0 0 15px 0;
  }
  .cert-body .main-text {
    font-size: 1.1rem;
    line-height: 1.8;
    margin: 0 auto 30px auto;
    max-width: 90%;
  }
  .results-section {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 30px;
    padding: 15px;
    background-color: rgba(240, 240, 240, 0.5);
    border-radius: 10px;
  }
  .score-container, .scholarship-container {
    text-align: center;
  }
  .results-section p {
    margin: 0;
    font-size: 1rem;
    color: #555;
  }
  .results-section strong {
    font-size: 1.8rem;
    color: var(--primary-color);
    display: block;
    margin-top: 5px;
  }
  .cert-footer {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-top: 40px;
  }
  .signature-area, .qr-code-area {
    text-align: center;
  }
  .signature-area p {
    margin: 0;
    font-size: 0.9rem;
  }
  #qrcode {
    width: 90px;
    height: 90px;
    margin: 0 auto 5px auto;
    border: 1px solid #eee;
    padding: 5px;
  }

  .certificate-actions {
    margin-top: 2rem;
  }
  .certificate-actions button {
    font-family: 'Cairo', sans-serif;
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    background-color: var(--primary-color);
    color: white;
    border-radius: 5px;
    margin: 0 5px;
    transition: background-color 0.3s;
  }
  .certificate-actions button:hover {
    background-color: #00251a;
  }
  /* Media query for mobile devices */
@media (max-width: 600px) {
  #printable-certificate {
    width: 95%; /* Make the certificate take up most of the screen width */
    padding: 10px; /* Reduce padding to save space */
  }

  .cert-border {
    padding: 10px; /* Reduce border padding */
  }

  .cert-header img {
    width: 70px; /* Smaller logo */
  }
  
  .cert-header h1 {
    font-size: 1.2rem; /* Smaller main heading */
  }
  
  .cert-header h2 {
    font-size: 0.9rem; /* Smaller sub-heading */
  }

  .cert-body .intro-text,
  .cert-body .main-text,
  .signature-area p,
  .qr-code-area p {
    font-size: 0.8rem; /* Smaller body text */
  }
  
  .cert-body .student-name {
    font-size: 1.5rem; /* Smaller name font */
  }

  .results-section {
    flex-direction: column; /* Stack results vertically */
    gap: 10px; /* Smaller gap */
    padding: 8px;
  }
  
  .results-section strong {
    font-size: 1.1rem; /* Smaller score/scholarship font */
  }

  .cert-footer {
    flex-direction: column; /* Stack footer elements vertically */
    align-items: center; /* Center footer items */
    gap: 15px; /* Add some space between them */
  }
  
  #qrcode {
    width: 60px; /* Smaller QR code for mobile */
    height: 60px;
  }

  .certificate-actions {
    flex-direction: column; /* Stack buttons vertically */
    gap: 10px;
    width: 100%;
  }

  .certificate-actions button {
    font-size: 0.9rem; /* Smaller button font */
    padding: 8px 15px; /* Smaller button padding */
  }
}

  @media print {
    body * { visibility: hidden; }
    #printable-certificate, #printable-certificate * {
      visibility: visible;
    }
    #printable-certificate {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      border: none;
      box-shadow: none;
      margin: 0;
      padding: 20px;
    }
    .certificate-actions { display: none; }
  }
  /* New styles for dropdown containers */
.dropdown-container {
  position: relative;
  display: inline-block;
  margin: 0 5px;
}

.dropdown-options {
  position: absolute;
  bottom: 100%; /* Position above the button */
  left: 50%;
  transform: translateX(-50%);
  background-color: white;
  border: 1px solid var(--primary-color);
  border-radius: 5px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  min-width: 150px;
  z-index: 10;
  margin-bottom: 5px;
  padding: 5px;
  display: flex;
  flex-direction: column;
}

.dropdown-options a {
  padding: 8px 12px;
  text-decoration: none;
  color: var(--primary-color);
  font-size: 0.9rem;
  transition: background-color 0.3s;
  text-align: center;
}

.dropdown-options a:hover {
  background-color: #f0f0f0;
}
/* Adjustments for mobile view */
@media (max-width: 600px) {
    .dropdown-options {
        bottom: auto;
        top: 100%;
        margin-top: 5px;
    }
}
/* New styles for a professional button layout */
.certificate-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px; /* Adds space between button groups */
}

.actions-group {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px; /* Adds space between buttons within each group */
    flex-wrap: wrap; /* Allows buttons to wrap to the next line on small screens */
}

/* Adjustments for mobile view */
@media (max-width: 600px) {
    .actions-group {
        flex-direction: column; /* Stacks buttons vertically on small screens */
    }
}
/*
 * Ù‡Ø°Ù‡ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ØªØ¶Ù…Ù† Ø£Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„.
 */
@media (max-width: 600px) {
  /* ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
  .dropdown-options {
    position: absolute; /* Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø³Ø¨ÙŠ */
    bottom: auto; /* Ø¥Ø²Ø§Ù„Ø© Ø®Ø§ØµÙŠØ© bottom Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªØ³Ø¨Ø¨ Ù…Ø´Ø§ÙƒÙ„ */
    top: 100%; /* ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ø²Ø± Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ */
    left: 50%;
    transform: translateX(-50%);
    width: 150px; /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
    padding: 5px;
  }

  /* Ø¬Ø¹Ù„ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø±Ù†Ø© Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø´ÙƒÙ„ Ø¹Ù…ÙˆØ¯ÙŠ */
  .certificate-actions {
    flex-direction: column;
    gap: 10px;
  }
}
</style>
<link href="favicon.png" rel="icon" type="image/png"/><link href="favicon.ico" rel="shortcut icon" type="image/x-icon"/></head>
<body>
<div id="printable-certificate">
<div class="cert-border">
<div class="cert-header">
<img alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©" src="assets/images/logo.webp"/>
<h1>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© - ØºØ²Ø©</h1>
<h2>Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø±Ø­Ù„Ø© ØªØ¹Ø±ÙŠÙÙŠØ©</h2>
</div>
<div class="cert-body">
<p class="intro-text">ØªØ´Ù‡Ø¯ Ø¹Ù…Ø§Ø¯Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø¨Ø© Ø¨Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨/Ø©</p>
<h2 class="student-name" id="cert-player-name">[Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨]</h2>
<p class="main-text">Ù‚Ø¯ Ø£ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ Ø±Ø­Ù„Ø© "Ø±Ø­Ù„ØªÙŠ ÙÙŠ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©" Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŒ ÙˆØ£Ø¸Ù‡Ø± Ù…Ø¹Ø±ÙØ© Ù…Ù…ØªØ§Ø²Ø© Ø¨Ù…Ø±Ø§ÙÙ‚ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© ÙˆÙƒÙ„ÙŠØ§ØªÙ‡Ø§ Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø©.</p>
<div class="results-section">
<div class="score-container">
<p>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</p>
<strong id="cert-final-score">0</strong>
</div>
<div class="scholarship-container">
<p>Ø§Ù„Ù…Ù†Ø­Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</p>
<strong id="cert-scholarship-details">---</strong>
</div>
</div>
</div>
<div class="cert-footer">
<div class="signature-area">
<p>___________________</p>
<p><strong>Ø¹Ù…ÙŠØ¯ Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø¨Ø©</strong></p>
</div>
<div class="qr-code-area">
<div id="qrcode"></div>
<p>Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</p>
</div>
<div class="signature-area">
<p>___________________</p>
<p><strong>Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</strong></p>
</div>
</div>
</div>
</div>
<div class="certificate-actions">
    <div class="actions-group">
        <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
        <button onclick="downloadCertificate()">ğŸ“· ØªØ­Ù…ÙŠÙ„ ÙƒØµÙˆØ±Ø©</button>
    </div>

    <div class="actions-group">
        <div class="dropdown-container">
            <button id="shareButton">ğŸŒ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
            <div class="dropdown-options" id="shareOptions" style="display:none;">
                <a href="#" id="share-facebook" target="_blank" class="share-btn facebook">ÙÙŠØ³Ø¨ÙˆÙƒ</a>
                <a href="#" id="share-twitter" target="_blank" class="share-btn twitter">ØªÙˆÙŠØªØ± (X)</a>
                <a href="#" id="share-linkedin" target="_blank" class="share-btn linkedin">Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†</a>
                <a href="#" id="share-whatsapp" target="_blank" class="share-btn whatsapp">ÙˆØ§ØªØ³Ø§Ø¨</a>
            </div>
        </div>

        <div class="dropdown-container">
            <button id="telegramButton">ğŸ‘¥ Ø§Ù†Ø¶Ù… Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <div class="dropdown-options" id="telegramOptions" style="display:none;">
                <a href="https://t.me/iug2006" target="_blank" class="telegram-btn">Ø·Ù„Ø§Ø¨ 2006</a>
                <a href="https://t.me/Iug2007" target="_blank" class="telegram-btn">Ø·Ù„Ø§Ø¨ 2007</a>
            </div>
        </div>
    </div>
    
    <div class="actions-group">
        <button onclick="window.location.href='index.html'">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø©</button>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
    function populateCertificateData() {
        const params = new URLSearchParams(window.location.search);
        let playerName = params.get("name");
        let playerScore = parseInt(params.get("score"));

        try {
            const saved = localStorage.getItem('iugGameProgress');
            if (saved) {
                const state = JSON.parse(saved);
                if (!playerName || playerName.trim() === "") {
                    if (state.playerName) playerName = state.playerName;
                    else if (state.name) playerName = state.name;
                    else if (state.player) playerName = state.player;
                }
                if (!Number.isFinite(playerScore)) {
                    if (typeof state.score === "number") playerScore = state.score;
                    else if (typeof state.totalScore === "number") playerScore = state.totalScore;
                    else if (typeof state.points === "number") playerScore = state.points;
                }
            }
        } catch (e) {
            console.warn("Failed to read game state:", e);
        }

        if (!playerName || playerName.trim() === "") playerName = "Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨";
        if (!Number.isFinite(playerScore)) playerScore = 0;

        document.getElementById("cert-player-name").textContent = playerName;
        document.getElementById("cert-final-score").textContent = playerScore;

        const scholarshipEl = document.getElementById("cert-scholarship-details");
        let scholarshipPercentage = 0;
        if (playerScore >= 50) scholarshipPercentage = 50;
        else if (playerScore > 0) scholarshipPercentage = playerScore;
        scholarshipEl.textContent =
            scholarshipPercentage > 0
                ? `Ù…Ù†Ø­Ø© ${scholarshipPercentage}% Ù„Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„`
                : "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ù†Ø­Ø©";

        const audio = document.getElementById("success-audio");
        if (audio) {
            audio.currentTime = 0;
            audio.play().catch(err => console.log("Autoplay blocked:", err));
        }

        const qrcodeContainer = document.getElementById("qrcode");
        if (qrcodeContainer) {
            qrcodeContainer.innerHTML = '';
            new QRCode(qrcodeContainer, {
                text: `Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø±Ø­Ù„Ø©\\nØ§Ù„Ø·Ø§Ù„Ø¨: ${playerName}\\nØ§Ù„Ù†Ù‚Ø§Ø·: ${playerScore}\\nØ§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø¨ØºØ²Ø©`,
                width: 90,
                height: 90,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }
    }

    function downloadCertificate() {
        const certificate = document.getElementById('printable-certificate');
        const options = {
            scale: 2,
            useCORS: true,
            backgroundColor: null
        };

        html2canvas(certificate, options).then(canvas => {
            const link = document.createElement('a');
            link.download = 'certificate.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    function updateShareLinks() {
        const playerName = document.getElementById("cert-player-name").textContent;
        const playerScore = document.getElementById("cert-final-score").textContent;
        
        const title = `Ø£Ù†Ø§ ${playerName} ÙˆÙ‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!`;
        const scoreText = `Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${playerScore} Ù†Ù‚Ø·Ø©!`;
        const websiteUrl = window.location.href;
        
        const message = `${title}\n${scoreText}\nØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·: ${websiteUrl}`;
        const encodedMessage = encodeURIComponent(message);
        
        const facebookLink = `https://www.facebook.com/sharer/sharer.php?quote=${encodedMessage}&u=${encodeURIComponent(websiteUrl)}`;
        document.getElementById('share-facebook').href = facebookLink;
        
        const twitterLink = `https://twitter.com/intent/tweet?text=${encodedMessage}`;
        document.getElementById('share-twitter').href = twitterLink;

        const linkedinLink = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(websiteUrl)}&title=${encodeURIComponent(title)}&summary=${encodedMessage}`;
        document.getElementById('share-linkedin').href = linkedinLink;

        const whatsappLink = `https://wa.me/?text=${encodedMessage}`;
        document.getElementById('share-whatsapp').href = whatsappLink;
    }

    function setupButtons() {
        const shareButton = document.getElementById('shareButton');
        const telegramButton = document.getElementById('telegramButton');
        const shareOptions = document.getElementById('shareOptions');
        const telegramOptions = document.getElementById('telegramOptions');
        const allDropdowns = [shareOptions, telegramOptions];
        const allButtons = [shareButton, telegramButton];

        // This flag helps to prevent the dropdown from immediately closing on touch devices
        let dropdownOpen = false;

        function toggleDropdown(targetDropdown) {
            const isVisible = targetDropdown.style.display === 'flex';
            
            // Close all other dropdowns
            allDropdowns.forEach(d => {
                d.style.display = 'none';
            });
            
            if (!isVisible) {
                targetDropdown.style.display = 'flex';
                // Set the flag after a short delay to ensure it's not immediately closed
                setTimeout(() => { dropdownOpen = true; }, 100);
            } else {
                dropdownOpen = false;
            }
        }

        // Use a single event listener for all relevant events
        allButtons.forEach(button => {
            const dropdown = button.id === 'shareButton' ? shareOptions : telegramOptions;
            
            button.addEventListener('click', (event) => {
                event.stopPropagation();
                toggleDropdown(dropdown);
            });
            
            button.addEventListener('touchstart', (event) => {
                event.stopPropagation();
                if (!dropdownOpen) {
                    toggleDropdown(dropdown);
                }
            });
        });

        // Event listener on the window to close the dropdowns
        window.addEventListener('click', (event) => {
            if (dropdownOpen && !shareButton.contains(event.target) && !telegramButton.contains(event.target)) {
                allDropdowns.forEach(d => d.style.display = 'none');
                dropdownOpen = false;
            }
        });
    }
    
    window.addEventListener('DOMContentLoaded', () => {
        populateCertificateData();
        setupButtons();
        updateShareLinks();
    });
</script>
</script>
</body>
</html>